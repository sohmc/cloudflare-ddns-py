language: python
python:
  - "3.6"

env:
  - EMAIL=cloudflare.kz21@torque.mikesoh.com API_KEY=$GLOBAL_API_KEY
  - API_KEY=$API_TOKEN

before_script:
  - bash .travis/create_template.bash

script:
  - python cloudflare-ddns.py -f -c .travis/cf_ddns.conf

before_deploy:
  - pip install pyinstaller
  - pyinstaller --onefile ./cloudflare-ddns.spec
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  api_key: $GITHUB_API_TOKEN
  file: ./dist/cloudflare-ddns/cloudflare-ddns
  skip_cleanup: true
  draft: true
  on:
    branch: master
    tags: true
